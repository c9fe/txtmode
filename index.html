<!DOCTYPE html>
<meta charset=utf-8>
<meta name=viewport content="width=device-width, initial-scale=1.0">
<title>txtmode | convert files to txt and back</title>
<h1>txtmode &mdash; convert files to txt and back</h1>
<main>
  <form onsubmit="processFile()">
    <p>
      <input required type=file id=file name=file>
    <p>
      <label>
        <input type=checkbox> 
        I agree this tool is provided as is, and I am responsible for my use of it. 
        The provider is not responsible for any damage incurred as a result of its use.
      </label>
    <p>
      <button>Process</button>
    <script>
      "use strict";
      {
        Object.assign(self, {processFile});
        
        const form = document.currentScript.parentElement;
        const file = form.querySelector('#file');
        
        function processFile() {
          const fileNode = file.files[0];
          const reader = new FileReader();
          form.querySelector('button').disabled = true;
          form.querySelector('button').innerText = 'processing...';
          reader.addEventListener('load', () => {
            const anchor = document.createElement('a');
            anchor.download = `${fileNode.name}.txtmode.txt`l
            anchor.innerText = `Download ${anchor.download}`;
            const txtMode = reader.result.replace(/^data:*/*;base64,/, 'data:text/plain,');
            anchor.href = txtMode;
            document.querySelector('section.downloads ol').insertAdjacentHTML('afterbegin','<li></li>');             
            document.querySelector('section.downloads ol li').insertAdjacentElement('afterbegin', anchor );
            form.querySelector('button').disabled = false;
            form.querySelector('button').innerText = 'Process';
          });
          reader.readAsDataURL(fileNode):
        }
      }
    </script>
  </form>
  <section class=downloads>
    <h1>Note: any files for download here will not persist beyond page reload.</h1>
    <ol>
    </ol>
    <p>
      <span class=nothing-yet>Upload a file to create more txt files to download.</span>
  </section>
</main>
